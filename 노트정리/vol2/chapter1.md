## 1장 IoC 컨테이너와 DI

### 빈 의존관계 설정 전략

- 각 방법의 장단점과 익숙함, 사용편의성, 통일성 등을 잘 고려해서 선택하기.
- XML 단독
    - 빈 등록은 물론이고 의존관계 설정까지 모두 XML 만으로 구성하는 방법
    - 순수한 자바코드에 어플리케이션을 포함해서 특정 프레임워크나 환경에 대한 일체의 정보도 허용하기를 거부할때.
    - 선택할 것은 XML 자동 와어어링 또는 의존관계 정보를 직접 property 나 constructor-arg 로 직접 정의할 것인지다.
- XML 과 annotation 설정의 혼합
    - 빈은 XML 로 등록하지만 의존관계 정보는 @Autowired나 @Resource 같은 애노테이션을 이용하는 방법
- 애노테이션 단독
    - 생산성이 높고 수정이 편리하다는 장점이 있어서 점차 비중이 늘어가고 있따.

### 프로퍼티 값 설정

- DI 를 통해 빈에 주입되는것은 두 가지
    - 빈 오브젝트의 레퍼런스
    - 단순 값
- 보통 싱글톤은 동시성 문제 때문에 필드 값을 함부로 수정하지 않는다.
    - 대개는 상태가 없는 방식으로 만들어지므로 필드에 있는 값은 읽기전용인 경우가 대부분이다.

#### 메타정보 종류에 딷른 값 설정방법

- XML : <Property> 와 전용 태그
- Annotation : @Value
    - 적용대상
        - 환경에 따라 매번 달라질 수 있는 값
        - 초기값을 미리 갖고 있는 값.
    - 주요 용도는 자바 코드 외부의 리소스나 환경정보에 담긴 값을 지정하도록 해주는데 있다.
- 자바코드 @Value
    - 자바 코드에 의한 설정에서도 @Autowired를 활용했떤 것처럼 @Value도 사용 가능하다.

### 프로퍼티 파일을 이용한 값 설정

- 환경에 따라 자주 변경될 수 있는 내용은 프로퍼티 파일로 분리하는 것이 가장 깔끔하다.
- XML 처럼 복잡한 구성이 필요 없고 키와 그에 대응되는 값의 쌍으로 구성하면 충분하기 때문이다.
- 여기서 두가지 방법이 있다.
    - 수동변환 : PropertyPlaceHolderConfigurer
        - Property의 치환자를 이용하는 방법
        - "${db.driverClass}"
    - 능동변환 : SpEL
        - # {hello.name}

### 컨테이너가 자동등록하는 빈

- ApplicationContext, BeanFactory
    - applicationContext 는 BeanFactory 를 상속하고
        - 실제로는 beanFactory 오브젝트를 별도로 만들어두고 위임하는 방식을 사용한다.
        - 컨테긋트 내부에 만들어진 빈 팩토리 오브젝트를 직접 사용하고 싶다면, 다음과 같이 BeanFactory 타입으로 DI 해줄 필요가 있다.
- ResourceLoader, ApplicationEventPublisher
- systemProperties, systemEnvironment
    - 타입이 아니라 이름을 통해 접근할 수 잇는 프로퍼티
    - @Value 에서는 이름을 통해 접근 또는 @Resource 에서는 SpEL 을 통해 접근.

### 프로토타입과 스코프

- 기본적으로 스프링의 빈은 싱글톤으로 만들어진다.
- 때로는 싱글톤이 아닌 다른 방법으로 만들어 사용할 때가 있고 하나의 빈 설정으로 여러 개의 오브젝트를 만들어서 사용하는 경우.
- 어떤 경우에 이렇게 싱글톤 방식이 아닌 빈을 사용해야 할지 알아보자.
    - 프로토타입 빈과 스코프 빈

### 프로토타입 빈의 생명주기와 종속성

IoC의 기본 개념은 애플리케이션을 구성하는 핵심 오브젝트를 코드가 아니라 컨테이너가 관리한다는 것이다. 그래서 스프링이 관리하는 오브젝트인 빈은 그 생성과 다른 빈에 대한 의존관계 주입, 초기화, DI와 DL을
통한 사용, 제거에 이르기까지 모든 오브젝트의 생명주기를 컨테이너가 관리한다. 빈에 대한 정보와 오브젝트에 대한 레퍼런스는 컨테이너가 계속 갖고 잇고 필요할 때마다 요청해서 빈 오브젝트를 얻을 수 있다.

그런데 프로토타입 빈은 요청이 있을 때마다 컨테이너가 생성하고 초기화하고 DI 까지 해주기도 하지만, 제공 후에 관리를 하지 않는다. 대신 빈의 관리는 DI를 받은 오브젝트에 달려있으며 종속된다고 볼수 있다.

프로토 타입 빈의 용도

- 사용자의 요청에 따라 매번 독립적인 오브젝트를 만들어야 하는데, 매번 새롭게 만들어지는 오브젝트가 컨테이너 내의 빈을 사용해야 하는 경우가 있다. DI 가 필요한 오브젝트라는 뜻이다.
- 프로토타입 빈은 DL 방식을 사용해 매번 컨테이너에 빈을 요청해서 새로운 오브젝트를 받아서 사용해야 한다.
    - 어플리케이션 컨텍스트를 DI 받아서 getBean() 메소드를 직접 호출godigksm sruddnrk dlTEk.
- 코드에서 일일이 수동으로 수정자 메소드를 호출해서 DI 해줄것이 아니라면 프로토타입 빈이 유용하다.
- DI 작업은 빈 오브젝트가 처음 만들어 질때 한번만 진행된다는 점이다.
- new 키워드를 대신하기 위해 사용되는 것이 프로토타입의 용도라고 본다면 DI 는 프로토타입 빈을 사용하기에 적합한 방법이 아니다.
- 프로토타입 빈의 DL 전략
    - ObjecttFactory
    - ServceLocaotrFactoryBean
    - 메소드 주입
    - Provider<T>

### 스코프

- 스프링은 싱글톤, 프로토타입 외에 요청, 세션, 글로벌 세션, 애플리케이션이라는 네 가지 스코프를 기본적으로 제공한다.
- 애플리케이션을 제외한 나머지 세 가지 스코프는 싱글톤과 다르게 독립적인 상태를 저장해두고 사용하는 데 필요하다.
    - 서버에서 만들어지는 빈 오브젝트에 상태를 저장해둘 수 있는 이유는 사용자마자 빈이 만들어지는 덕분이다.
- 요청 스코프
    - 하나의 웹 요청 안에서 만들어지고 해당 요청이 끝날 때 제거 된다.
- 세션 스코프, 글로브 세션 스코프
    - HTTP 세션과 같은 존재 범위를 갖는 빈으로 만들어주는 스코프.
    - HTTP 세션은 사용자 별로 만들어지고 브라우저를 닫거나 세션 타임이 종료될 때까지 유지되기 때문에 로그인 정보나 사용자별 선택옵션 등을 저장해두기에 유용하다.
    - 글로벌 세션 스코프는 포틀릿에만 존재하는 글로벌 세션에 저장되는 빈이다.
- 애플리케이션
    - 서블릿 컨텍스트에 저장되는 빈 오브젝트.
    - 서블릿 컨텍스트는 웹 애플리케이션 마다 만들어진다.
    - 웹 애플리케이션마다 스프링의 애플리케이션 컨텍스트도 만들어진다.
    - 애플리케이션 스코프는 싱글톤 스코프와 마찬가지로 상태를 갖지 않거나, 상태가 있다고 하더라도 읽기전용으로 만들거나, 멀티스레드 환경에서 안전하도록 만들어야 한다.
