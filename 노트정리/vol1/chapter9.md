#9장 스프링 프로젝트 시작하기


스프링으로 만든 애플리케이션을 자바 서버환경에 배포 하려면 J2EE 서버가 필요하다. 애플리케이션 서버는 두가지로 구분이 가능한데
- JavaEE 의 대부분의 표준 기술을 지원하고 다양한 형태의 모듈로 배포가 가능한 완전한 웹 애플리케이션 서버 WAS 이고
- 다른 하나는 웹 모듈의 배포만 가능한 경량급 WAS 또는 서블릿/ JPS 컨테이너다.


## 경량급 WAS/서블릿 컨테이너

- 기본적으로 Tomcat이나 Jetty 같은 서블릿 컨테이너만 있어도 충분하다.
- 물론 고가의 WAS를 사용하면 그만큼 장점이 있다.

## 스프링 애플리케이션의 배포 단위

- 독립 웹 모듈 : 보통 war로 패키징된 독립 웹 모듈로 배포된다.
- 엔터프라이즈 애플리케이션
    - 확장자가 ear
    - EJB 모듈을 긴밀하게 사용하거나 EJB모듈에서 스프링으로 만든 애플리케이션을 이용해야할 때
- 백그라운드 서비스 모듈 : rar 패키징 방법 / 리소스 커넥트를 만들어 배포


## 애플리케이션 아키텍처


## 계층형 아키텍처

### 아키텍처와 SoC
- 지금까지는 주로 오브젝트 레벨에서 이런 분리의 문제에 대해 생각해봤다.
- 성격이 다른 코드가 얽혀 있는 것을 두 개의 오브젝트로 분리하고,
  - 그 사이에 유연한 결합을 가질 수 있도록 인터페이스를 두고, 
  - 그 관계를 맺어주는 제3의 존재인 DI 컨테이너를 둬서, 
  - 오브젝트끼리는 직접적인 관계를 알지 못하도록 만드는 것이, 
  - 지금까지 해온 DI를 기반으로한 유연한 설계와 구현 전략이었다.
   
> 애플리케이션 을 구성하는 오브젝트들을 비슷한 성격과 책임을 가진 것들끼리 묶을 수 있다. 
> 
> 예를 들면 데이터 액세스 로직을 담당하는 DAO들은 하나의 단위로 생각해도 좋다. 성격이 다른 것은 아키텍터 레벨에서 분리해주는 게 좋다.
 
 
## 3-계층 아키텍처

### 구성
- 데이터 액세스 계층
- 서비스 계층
- 프레젠테이션 계층
 
### 계층형 아키텍처 설계의 원칙
 
- 오브젝트와 그 관계에 적용했던 대부분의 객체지향 설계의 원칙은 아키텍처 레벨의 계층과 그 관계에도 동일하게 적용할 수 있다.
- 각 계층은 응집도가 높으면서 다른 계층과는 낮은 결합도를 유지할 수 있어야 한다.
- 각 계층은 자신의 계층의 책임에만 충실해야 한다.
- 데이터 액세스 계층은 데이터 액세스에 관한 모든 것을 스스로 처리해야 한다.  

### 스프링의 DI 는 기본적으로 오브젝트 사이의 관계를 다룬다.
- 따라서 계층 사이의 경계나 그 관계에 직접적으로 관여하지 않는다.
- 하지만 모든 경계에는 오브젝트가 존재하고 그 사이의 관계에도 오브잭트 대 오브잭트로 정의되기마련이므로 스프링의 DI 가 계층 사이의 관계에도 적용된다고 볼 수 있다.

### DB 중심의 로직 구현 방식
- 단지 익숙하고 편하다는 이유로 스프링 애플리케이션 개발에도 여전히 DB 중심의 아키텍처를 선택한다면 스프링의 장점을 제대로 누릴 수 있는 기회를 얻지 못할 것이 분명하다.

### 거대한 서비스 계층 방식

- 주요 로직은 서비스 계층의 코드에서 처리하도록 만드는 것.
- 장점은 애플리케이션의 코드에 비즈니스 로직이 담겨 있기 때문에 자바 언어의 장점을 활용해 로직을 구현할 수 있고 테스트하기도 수월하다는 점이다.
- 또한 DAO 가 다루는 SQL 이 복잡하지 않고 프레젠테이션 계층의 뷰와 1:1로 매핑되지 않아도 되기 때문에 일부 DAO 코드는 여러 비즈니스 로직에서 공유해서 사용할 수 있다.
- 데이터 중심 아키텍처의 특징은 계층 사이의 결합도가 높은 편이고 응집도는 떨어진다는 점.
    - 화면을 중심으로 하는 업무 트랜잭션 단위로 코드가 모이기 때문에 처음엔 개발하기 편하지만 중복이 많아지기 쉽고 장기적으로 코드를 관리하고 발전시키기 힘들다는 단점이 있다.


## 9.3.3. 오브젝트 중심 아키텍처

- 오브젝트 중심 아키텍처가 데이터 중심 아키텍처와 다른 가장 큰 특징은 도메인 모델을 반영하는 오브젝트 구조를 만들어두고 그것을 각 계층 사이에서 정보를 전송하는 데 사용한다는 것이다.
- 오브젝트 중심 아키텍처는 객체지향 분석과 모델링의 결과로 나오는 도메인 모델을 오브젝트 모델로 활용한다.
- 대게 도메인 모델은 DB의 엔티티 설계에도 반영되기 때문에 관계형 DB의 엔티티 구조와도 유사한 형태일 가능성이 높다.
- 이렇게 오브젝트를 만들어두고 오브젝트 구조 안에 정보를 담아서 각 계층 사이에 전달하게 만드는 것이 오브젝트 중심 아키텍처다.
- 최적화된 SQL 을 매번 만들어 사용하는 경우에 비해 성능면에서 조금은 손해를 감수해야 할 수도 있다.
    - 그래서 도메인 오브젝트를 사용하는 오브젝트 중심 아키텍처에서는 가능하다면 ORM 과 같은 오브젝트 중심 데이터 액세스 기술을 사용하는 것을 권장한다.
    - 사용하기 쉽고 직관적이며 코드의 양도 대폭 줄기 때문이다.
    - 다양한 기법을 이용하면 SQL을 직접 만들어 쓰는 경우에 못지않게 성능을 향상시킬 수 있다.
- 오브젝트 중심 아키텍처는 오브젝트의 활용 방법을 기준으로 다시 구분해 볼 수 있다.


### 빈약한 도메인 오브젝트 방식

- 도메인 오브젝트에 정보만 담겨 있고, 정보를 활용하는 아무런 기능도 갖고 있지 않다면 이는 온전한 오브젝트라고 보기 힘들다, 그래서 이런 오브젝트를 빈약한 오브젝트라고 부른다.

### 풍성한 도메인 오브젝트 방식

- 간단한 자신에 대한 로직을 수행해도 되지만 빈들을 DI 받아서 사용 하면안된다.
- 스프링의 빈으로 관리되는 3계층의 오브젝트들은 도메인 오브젝트를 자유롭게 이용할 수 있지만 그 반대는 안된다는 사실을 주의해야 한다.


###도메인 계층 방식

- 메인 오브젝트들이 하나의 독립적인 계층을 이뤄서 서비스 계층과 데이터 액세스 계층의 사이에 존재하게 하는 것이다.
- 도메인 오브젝트가 독립된 계층을 이룸으로써 달라지는 두 가지 특징.
- 첫째, 도메인에 종속적인 비즈니스 로직의 처리는 서비스 계층이 아니라 도메인 계층의 오브젝트안에서 진행된다.
- 둘째, 도메인 오브젝트가 기존 데이터 액세스 계층이나 기반 계층의 기능을 직접 활용할 수 있다는 것이다.
    - 스프링이 관리하지 않는 도메인 오브젝트에 DI를 적용하기 위해서는 AOP 가 필요하다.
    - 스프링의 AOP는
        - AOP는 부가기능을 추가할 수 있는 위치가 메소드 호출 과정으로 한정되고
        - AOP의 적용 대상도 스프링의 빈 오브젝트뿐이다.
    - 하지만 스프링 AOP 대신 AspectJ AOP 를 사용하면
        - 클래스의 생성자가 호출되면서 오브젝트가 만들어지는 시점을 조인 포인트로 사용할 수 있고
        - 스프링 빈이 아닌 일반 오브젝트에도 AOP 부가기능을 적용할 수 있다.
- 도메인 계층이 다른 계층에도 침범, 또는 다른 계층에서 함부로 호출 것을 막기 위한 방법으로
    - 1. AspectJ의 정책/표준 강제화 기능을 사용할 수 있다.
    - 2. 도메인 오브젝트는 도메인 계층을 벗어나지 못하게 하고, 계층 밖으로 정보 전달을 하기 위해서는 DTO 를 사용한다.
        - DTO는 상태의 변호를 허용하지 않고 읽기 전용으로 만들어지기도 한다.
        - 도메인 계층으로 정보 전달시에도 DTO 를 사용할 수 있다.


## 9.4. 정리

9장에서는 스프링을 애플리케이션 프로젝트를 만들면서 초기에 결정해야 할 내용에 대해 살펴봤다.

스프링 자체가 워낙 범용적이고 유연해서 어떤 종류의 아키텍처나 프로젝트에도 적합하긴 하지만, 그렇다고 아무렇게나 가져다 사용해도 되는 것은 아니다.

먼저 최적의 개발환경과 도구, 플랫폼을 결정해서 준비해두고, 애플리케이션의 아키텍처와 사용할 기술 등을 신중하게 선택해야 한다.

또한 스프링 애플리케이션에 적용할 서드파티 기술과 라이브러리에 대한 접근 방법을 개발이 시작되기 전에 충분히 검토하고 준비해둘 필요가 있다.

여기서 살펴본 내용은 다음과 같다.

- 스프링은 어떤 플랫폼에서도 사용될 수 있지만, 기본적으로는 자바 엔터프라이즈 플랫폼에 최적화되어 있다.
- HTTP를 통해 접근하는 웹 클라이언트와 백엔드 DB를 사용하는 애플리케이션에 적합하다.
- 스프링 개발의 생산성을 즏애시키고 품질을 높이려면 Spring IDE 플러그인이나, STS같은 적절한 툴의 지원이 필요하다.
- 스프링은 의존 라이브러리가 방대하기 때문에 라이브러리 관리와 의존관계를 관리하는 데 많은 노력을 기울여야 한다.
    - 가능하면 스프링이 의존관계 정보를 제공해주는 Maven 이나 Ivy 같은 빌드 툴을 사용해 의존 라이브러리를 관리하는 것이 바람직하다.
- 스프링 애플리케이션은 역할에 따라 3-계층으로 구분되고, 다시 기술의 추상도에 따라 세분화되는 계층형 아키텍처를 사용하는 것이 좋다.
    - 아키텍처는 애플리케이션이 다루는 정보의 관점에서 데이터 중심과 오브젝트 중심으로 구분 할 수 있다.
    - 스프링에 가장 잘 어울리는 아키텍처는 오브젝트 중심의 아키텍처나.
    - 스프링이 직접 지원하지 않는 서드파티 기술도 스프링 스타일의 접근 방식을 따라서 사용할 수 있도록 준비해둬야 한다.























